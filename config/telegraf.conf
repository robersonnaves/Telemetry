# Telegraf configuration bridging Prometheus remote_write to QuestDB via ILP
[agent]
  interval = "10s"
  flush_interval = "10s"
  metric_batch_size = 5000
  metric_buffer_limit = 50000
  omit_hostname = true

# Input: Prometheus remote_write (HTTP POST)
[[inputs.http_listener_v2]]
  service_address = ":9201"
  path = "/write"
  data_format = "prometheusremotewrite"
  read_timeout = "30s"
  write_timeout = "30s"
  max_body_size = 50000000

# Optional processors (examples commented out)
# [[processors.regex]]
#   namepass = ["http_requests_total"]
#   [[processors.regex.tags]]
#     key = "path"
#     pattern = "^/internal/.*"
#     replacement = "/internal"

# [[aggregators.basicstats]]
#   period = "1m"
#   drop_original = true
#   stats = ["mean","max","min"]
#   namepass = ["process_cpu_seconds_total","go_memstats_alloc_bytes"]

# Output: QuestDB via Influx Line Protocol over TCP
[[outputs.socket_writer]]
  address = "tcp://questdb:9009"
  data_format = "influx"
  keep_alive_period = "30s"
  inactivity_timeout = "2m"
  tls = false
