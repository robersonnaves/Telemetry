{
  "title": "Infra Prometheus - QuestDB [Ingestão]",
  "tags": [
    "prometheus",
    "questdb",
    "ingestao"
  ],
  "timezone": "browser",
  "time": {
    "from": "now-24h",
    "to": "now"
  },
  "panels": [
    {
      "id": 1,
      "title": "Taxa de Ingestão por Job (Amostras/Hora)",
      "type": "timeseries",
      "targets": [
        {
          "datasource": "QuestDB",
          "rawSql": "SELECT to_str(timestamp, 'yyyy-MM-dd HH') as hora, job, count() as amostras FROM prometheus_remote_write WHERE timestamp > dateadd('h', -24, now())GROUP BY hora, job ORDER BY hora",
          "format": "time_series"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 0
      }
    },
    {
      "id": 2,
      "title": "Memória Disponível (GB)",
      "type": "timeseries",
      "targets": [
        {
          "datasource": "QuestDB",
          "rawSql": "SELECT timestamp, job, node_memory_MemAvailable_bytes/1024/1024/1024 AS mem_gb FROM prometheus_remote_write WHERE timestamp > dateadd('h', -24, now()) AND node_memory_MemAvailable_bytes IS NOT NULL ORDER BY timestamp",
          "format": "time_series"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 0
      }
    },
    {
      "id": 3,
      "title": "Uso de CPU (%)",
      "type": "timeseries",
      "targets": [
        {
          "datasource": "QuestDB",
          "rawSql": "SELECT timestamp, job, node_cpu_seconds_total AS cpu FROM prometheus_remote_write WHERE timestamp > dateadd('h', -24, now()) AND node_cpu_seconds_total IS NOT NULL ORDER BY timestamp",
          "format": "time_series"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 8
      }
    },
    {
      "id": 4,
      "title": "Erros HTTP (mock)",
      "type": "stat",
      "targets": [
        {
          "datasource": "QuestDB",
          "rawSql": "SELECT job, sum(mock_http_errors_total) as erros FROM prometheus_remote_write WHERE timestamp > dateadd('h', -24, now()) GROUP BY job",
          "format": "table"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 16
      }
    },
    {
      "id": 5,
      "title": "Requisições HTTP (mock)",
      "type": "stat",
      "targets": [
        {
          "datasource": "QuestDB",
          "rawSql": "SELECT job, sum(mock_http_requests_total) as reqs FROM prometheus_remote_write WHERE timestamp > dateadd('h', -24, now()) GROUP BY job",
          "format": "table"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 16
      }
    }
  ],
  "templating": {
    "list": [
      {
        "name": "job",
        "type": "query",
        "datasource": "QuestDB",
        "query": "SELECT job FROM prometheus_remote_write WHERE timestamp > dateadd('d', -7, now()) GROUP BY job",
        "multi": true,
        "includeAll": true
      }
    ]
  },
  "annotations": {
    "list": [
      {
        "builtIn": 1
      }
    ]
  }
}